name: TSDM Auto Tasks

on:
  schedule:
    # Check-in daily at 09:00 UTC (17:00 CST)
    - cron: '0 9 * * *'
    # Work every 6 hours at :01 (UTC)
    - cron: '1 */6 * * *'
  workflow_dispatch:

jobs:
  tsdm-tasks:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v3

      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.10'

      - name: Install dependencies
        run: pip install httpx beautifulsoup4

      - name: Run Scheduled Task
        env:
          TSDM_COOKIE: ${{ secrets.TSDM_COOKIE }}
        run: |
          if [[ "${{ github.event_name }}" == "schedule" ]]; then
            if [[ "${{ github.event.schedule }}" == "0 9 * * *" ]]; then
              echo "‚è∞ Running daily check-in"
              python tsdm.py checkin
            elif [[ "${{ github.event.schedule }}" == "1 */6 * * *" ]]; then
              echo "üõ†Ô∏è Running 6-hour work"
              python tsdm.py work
            fi
          else
            echo "üîß Manual trigger - running both tasks"
            python tsdm.py checkin
            python tsdm.py work
          fi
